clone:
  git:
    image: plugins/git
    depth: 1
pipeline:
  build_step:
    image: plugins/docker
    username: ihealth
    password: iHealthStrategy2018
    registry: harbor.ihealthcn.com
    repo: harbor.ihealthcn.com/swift-snail/swift-snail
    mirror: 'https://registry.docker-cn.com'
    tag:
      - '${DRONE_BUILD_NUMBER}'
      - latest
    dockerfile: docker/stg/Dockerfile
    when:
      branch: develop
      event: push
  report-build:
    image: clem109/drone-wechat
    secrets:
      - plugin_corp_secret
      - plugin_corpid
      - plugin_agent_id
    title: '${DRONE_REPO_NAME}'
    description: |
      æ„å»ºåºåˆ—: ${DRONE_BUILD_NUMBER}å¤±è´¥ã€‚æ€¥é€Ÿ ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ æ„å»ºå¤±è´¥ï¼Œç‚¹å‡»å¡ç‰‡æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯ã€‚
    msg_url: '${DRONE_BUILD_LINK}'
    btn_txt: æŸ¥çœ‹è¯¦æƒ…
    when:
      status:
        - failure
  rancher:
    image: peloton/drone-rancher
    url: 'http://rancher.ihealthcn.com/v2-beta/projects/1a46'
    access_key: FC6450BBAC9464CD0069
    secret_key: 2mbbTGC2rHFV4kghdYfZwDfjmbsR94KwKDhcaWZ5
    service: 301-stg/swift-snail
    docker_image: 'harbor.ihealthcn.com/swift-snail/swift-snail:latest'
    batch_size: 1
    timeout: 600
    confirm: true
    when:
      branch: develop
      event: push
  report-deploy:
    image: clem109/drone-wechat
    secrets:
      - plugin_corp_secret
      - plugin_corpid
      - plugin_agent_id
    title: '${DRONE_REPO_NAME}'
    description: |
      æ„å»ºåºåˆ—: ${DRONE_BUILD_NUMBER} éƒ¨ç½²æˆåŠŸï¼ æˆ‘ä»¬å·²ç»å¸®æ‚¨è‡ªåŠ¨éƒ¨ç½²åˆ°Rancherï¼Œæ€¥é€Ÿ ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ å·²ç»å……æ»¡èƒ½é‡ï¼
      æ›´æ–°å†…å®¹: ${DRONE_COMMIT_MESSAGE}
    msg_url: 'http://120.92.88.112:3082/'
    btn_txt: æŸ¥çœ‹è¿è¡ŒçŠ¶å†µ
    when:
      branch: develop
      status:
        - success
        - failure
